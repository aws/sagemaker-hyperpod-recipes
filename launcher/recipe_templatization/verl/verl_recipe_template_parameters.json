{
    "_comment": [
        "VERL (Volcano Engine Reinforcement Learning for LLMs) Recipe Template Parameters Configuration",
        "",
        "This file defines template structure and parameters for VERL recipes using",
        "reinforcement learning algorithms like GRPO and PPO for fine-tuning.",
        "",
        "Key Features:",
        "1. TEMPLATE MATCHING: Supports verl_grpo and verl_ppo algorithm types",
        "2. RL-SPECIFIC PARAMETERS: Includes reward model, critic, and actor configurations"
    ],
    "templates": {
        "grpo_rlaif": {
            "recipe_template": {
                "run": {
                    "name": "{{name}}",
                    "results_dir": "{{results_directory}}"
                },
                "training_config": {
                    "trainer": {
                        "total_epochs": "{{max_epochs}}",
                        "default_local_dir": "{{output_path}}",
                        "resume_from_path": "{{resume_from_path}}"
                    },
                    "actor_rollout_ref": {
                        "actor": {
                            "optim": {
                                "lr": "{{learning_rate}}"
                            }
                        },
                        "rollout": {
                            "prompt_length": "{{max_prompt_length}}"
                        },
                        "model": {
                            "path": "{{model_name_or_path}}"
                        }
                    },
                    "data": {
                        "train_files": "{{data_path}}",
                        "val_files": "{{validation_data_path}}",
                        "train_val_split_ratio": "{{train_val_split_ratio}}",
                        "train_batch_size": "{{global_batch_size}}"
                    },
                    "reward_model": {
                        "reward_kwargs": {
                            "kwargs": {
                                "model_id": "{{judge_model_id}}",
                                "llmj_prompt_template_path": "{{judge_prompt_template}}"
                            }
                        }
                    },
                    "mlflow": {
                        "tracking_uri": "{{mlflow_tracking_uri}}",
                        "run_id": "{{mlflow_run_id}}"
                    }
                }
            },
            "recipe_override_parameters": {
                "name": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "data_path": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "validation_data_path": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "results_directory": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "output_path": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "resume_from_path": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "learning_rate": {
                    "type": "float",
                    "required": true,
                    "min": 1.0e-07,
                    "max": 1.0e-03,
                    "default": 1.0e-05
                },
                "max_epochs": {
                    "type": "integer",
                    "required": true,
                    "min": 1,
                    "max": 30,
                    "default": 3
                },
                "model_name_or_path": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "global_batch_size": {
                    "type": "integer",
                    "required": true,
                    "enum": [128, 256, 512, 1024],
                    "default": 128
                },
                "max_prompt_length": {
                    "type": "integer",
                    "required": true,
                    "min": 512,
                    "max": 16384,
                    "default": 1024
                },
                "judge_model_id": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "judge_prompt_template": {
                    "type": "string",
                    "required": false,
                    "enum": ["/opt/ml/code/verl/cot.jinja", "/opt/ml/code/verl/evaluate.jinja", "/opt/ml/code/verl/faithfulness.jinja", "/opt/ml/code/verl/summarize.jinja"],
                    "default": "/opt/ml/code/verl/summarize.jinja"
                },
                "train_val_split_ratio": {
                    "type": "float",
                    "required": false,
                    "min": 0.0,
                    "max": 1.0,
                    "default": 0.9
                },
                "mlflow_tracking_uri": {
                    "type": "string",
                    "required": false,
                    "default": ""
                },
                "mlflow_run_id": {
                    "type": "string",
                    "required": false,
                    "default": ""
                },
                "namespace": {
                    "default": "default",
                    "required": true,
                    "type": "string"
                }
            },
            "recipe_metadata_helpers": {
                "peft_techniques": {
                    "lora": "LoRA"
                },
                "rl_algorithms": {
                    "grpo": "GRPO"
                },
                "hardware_types": {
                    "gpu": ["ml.p4de.24xlarge", "ml.p5.48xlarge"]
                }
            }
        },
        "grpo_rlvr": {
            "recipe_template": {
                "run": {
                    "name": "{{name}}",
                    "results_dir": "{{results_directory}}"
                },
                "training_config": {
                    "trainer": {
                        "total_epochs": "{{max_epochs}}",
                        "default_local_dir": "{{output_path}}",
                        "resume_from_path": "{{resume_from_path}}"
                    },
                    "actor_rollout_ref": {
                        "actor": {
                            "optim": {
                                "lr": "{{learning_rate}}"
                            }
                        },
                        "rollout": {
                            "prompt_length": "{{max_prompt_length}}"
                        },
                        "model": {
                            "path": "{{model_name_or_path}}"
                        }
                    },
                    "data": {
                        "train_files": "{{data_path}}",
                        "val_files": "{{validation_data_path}}",
                        "train_val_split_ratio": "{{train_val_split_ratio}}",
                        "train_batch_size": "{{global_batch_size}}"
                    },
                    "custom_reward_function": {
                        "name": "{{preset_reward_function}}",
                        "lambda_arn": "{{reward_lambda_arn}}"
                    },
                    "mlflow": {
                        "tracking_uri": "{{mlflow_tracking_uri}}",
                        "run_id": "{{mlflow_run_id}}"
                    }
                }
            },
            "recipe_override_parameters": {
                "name": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "namespace": {
                    "default": "default",
                    "required": true,
                    "type": "string"
                },
                "data_path": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "validation_data_path": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "preset_reward_function": {
                    "type": "string",
                    "required": true,
                    "enum": ["", "gsm8k", "prime_code", "prime_math"],
                    "default": ""
                },
                "reward_lambda_arn":{
                    "type": "string",
                    "required": false,
                    "default": ""
                },
                "results_directory": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "output_path": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "resume_from_path": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "learning_rate": {
                    "type": "float",
                    "required": true,
                    "min": 1.0e-07,
                    "max": 1.0e-03,
                    "default": 1.0e-05
                },
                "max_epochs": {
                    "type": "integer",
                    "required": true,
                    "min": 1,
                    "max": 30,
                    "default": 3
                },
                "model_name_or_path": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "global_batch_size": {
                    "type": "integer",
                    "required": true,
                    "enum": [128, 256, 512, 1024],
                    "default": 128
                },
                "max_prompt_length": {
                    "type": "integer",
                    "required": true,
                    "min": 512,
                    "max": 16384,
                    "default": 1024
                },
                "train_val_split_ratio": {
                    "type": "float",
                    "required": false,
                    "min": 0.0,
                    "max": 1.0,
                    "default": 0.9
                },
                "mlflow_tracking_uri": {
                    "type": "string",
                    "required": false,
                    "default": ""
                },
                "mlflow_run_id": {
                    "type": "string",
                    "required": false,
                    "default": ""
                }
            },
            "recipe_metadata_helpers": {
                "peft_techniques": {
                    "lora": "LoRA"
                },
                "rl_algorithms": {
                    "grpo": "GRPO"
                },
                "hardware_types": {
                    "gpu": ["ml.p4de.24xlarge", "ml.p5.48xlarge"]
                },
                "preset_reward_function": {
                    "gsm8k": "Exact match (gsm8k)",
                    "prime_code": "Code executions (prime_code)",
                    "prime_math": "Math answers (prime_math)"
                }
            }
        },
        "grpo_rlaif_fft": {
            "recipe_template": {
                "run": {
                    "name": "{{name}}",
                    "results_dir": "{{results_directory}}"
                },
                "training_config": {
                    "trainer": {
                        "total_epochs": "{{max_epochs}}",
                        "default_local_dir": "{{output_path}}",
                        "resume_from_path": "{{resume_from_path}}"
                    },
                    "actor_rollout_ref": {
                        "actor": {
                            "optim": {
                                "lr": "{{learning_rate}}"
                            }
                        },
                        "rollout": {
                            "prompt_length": "{{max_prompt_length}}"
                        },
                        "model": {
                            "path": "{{model_name_or_path}}"
                        }
                    },
                    "data": {
                        "train_files": "{{data_path}}",
                        "val_files": "{{validation_data_path}}",
                        "train_val_split_ratio": "{{train_val_split_ratio}}",
                        "train_batch_size": "{{global_batch_size}}"
                    },
                    "reward_model": {
                        "reward_kwargs": {
                            "kwargs": {
                                "model_id": "{{judge_model_id}}",
                                "llmj_prompt_template_path": "{{judge_prompt_template}}"
                            }
                        }
                    },
                    "mlflow": {
                        "tracking_uri": "{{mlflow_tracking_uri}}",
                        "run_id": "{{mlflow_run_id}}"
                    }
                }
            },
            "recipe_override_parameters": {
                "name": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "data_path": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "validation_data_path": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "results_directory": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "output_path": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "resume_from_path": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "learning_rate": {
                    "type": "float",
                    "required": true,
                    "min": 1.0e-07,
                    "max": 1.0e-03,
                    "default": 1.0e-05
                },
                "max_epochs": {
                    "type": "integer",
                    "required": true,
                    "min": 1,
                    "max": 30,
                    "default": 3
                },
                "model_name_or_path": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "global_batch_size": {
                    "type": "integer",
                    "required": true,
                    "enum": [128, 256, 512, 1024],
                    "default": 128
                },
                "max_prompt_length": {
                    "type": "integer",
                    "required": true,
                    "min": 512,
                    "max": 16384,
                    "default": 1024
                },
                "judge_model_id": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "judge_prompt_template": {
                    "type": "string",
                    "required": false,
                    "enum": ["/opt/ml/code/verl/cot.jinja", "/opt/ml/code/verl/evaluate.jinja", "/opt/ml/code/verl/faithfulness.jinja", "/opt/ml/code/verl/summarize.jinja"],
                    "default": "/opt/ml/code/verl/summarize.jinja"
                },
                "train_val_split_ratio": {
                    "type": "float",
                    "required": false,
                    "min": 0.0,
                    "max": 1.0,
                    "default": 0.9
                },
                "mlflow_tracking_uri": {
                    "type": "string",
                    "required": false,
                    "default": ""
                },
                "mlflow_run_id": {
                    "type": "string",
                    "required": false,
                    "default": ""
                },
                "namespace": {
                    "default": "default",
                    "required": true,
                    "type": "string"
                }
            },
            "recipe_metadata_helpers": {
                "peft_techniques": {
                    "lora": "LoRA"
                },
                "rl_algorithms": {
                    "grpo": "GRPO"
                },
                "hardware_types": {
                    "gpu": ["ml.p4de.24xlarge", "ml.p5.48xlarge"]
                }
            }
        },
        "grpo_rlvr_fft": {
            "recipe_template": {
                "run": {
                    "name": "{{name}}",
                    "results_dir": "{{results_directory}}"
                },
                "training_config": {
                    "trainer": {
                        "total_epochs": "{{max_epochs}}",
                        "default_local_dir": "{{output_path}}",
                        "resume_from_path": "{{resume_from_path}}"
                    },
                    "actor_rollout_ref": {
                        "actor": {
                            "optim": {
                                "lr": "{{learning_rate}}"
                            }
                        },
                        "rollout": {
                            "prompt_length": "{{max_prompt_length}}"
                        },
                        "model": {
                            "path": "{{model_name_or_path}}"
                        }
                    },
                    "data": {
                        "train_files": "{{data_path}}",
                        "val_files": "{{validation_data_path}}",
                        "train_val_split_ratio": "{{train_val_split_ratio}}",
                        "train_batch_size": "{{global_batch_size}}"
                    },
                    "custom_reward_function": {
                        "name": "{{preset_reward_function}}",
                        "lambda_arn": "{{reward_lambda_arn}}"
                    },
                    "mlflow": {
                        "tracking_uri": "{{mlflow_tracking_uri}}",
                        "run_id": "{{mlflow_run_id}}"
                    }
                }
            },
            "recipe_override_parameters": {
                "name": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "namespace": {
                    "default": "default",
                    "required": true,
                    "type": "string"
                },
                "data_path": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "validation_data_path": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "preset_reward_function": {
                    "type": "string",
                    "required": true,
                    "enum": ["", "gsm8k", "prime_code", "prime_math"],
                    "default": ""
                },
                "reward_lambda_arn":{
                    "type": "string",
                    "required": false,
                    "default": ""
                },
                "results_directory": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "output_path": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "resume_from_path": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "learning_rate": {
                    "type": "float",
                    "required": true,
                    "min": 1.0e-07,
                    "max": 1.0e-03,
                    "default": 1.0e-05
                },
                "max_epochs": {
                    "type": "integer",
                    "required": true,
                    "min": 1,
                    "max": 30,
                    "default": 3
                },
                "model_name_or_path": {
                    "type": "string",
                    "required": true,
                    "default": ""
                },
                "global_batch_size": {
                    "type": "integer",
                    "required": true,
                    "enum": [64, 128, 256, 512, 1024],
                    "default": 128
                },
                "max_prompt_length": {
                    "type": "integer",
                    "required": true,
                    "min": 512,
                    "max": 16384,
                    "default": 1024
                },
                "train_val_split_ratio": {
                    "type": "float",
                    "required": false,
                    "min": 0.0,
                    "max": 1.0,
                    "default": 0.9
                },
                "mlflow_tracking_uri": {
                    "type": "string",
                    "required": false,
                    "default": ""
                },
                "mlflow_run_id": {
                    "type": "string",
                    "required": false,
                    "default": ""
                }
            },
            "recipe_metadata_helpers": {
                "peft_techniques": {
                    "lora": "LoRA"
                },
                "rl_algorithms": {
                    "grpo": "GRPO"
                },
                "hardware_types": {
                    "gpu": ["ml.p4de.24xlarge", "ml.p5.48xlarge"]
                },
                "preset_reward_function": {
                    "gsm8k": "Exact match (gsm8k)",
                    "prime_code": "Code executions (prime_code)",
                    "prime_math": "Math answers (prime_math)"
                }
            }
        }
    }
}
